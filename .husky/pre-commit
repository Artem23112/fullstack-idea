
# --- 1. Линтинг staged файлов ---
pnpm lint-staged || true   # <- ключевой момент: игнорируем ошибку, если нет staged файлов

# --- 2. Проверка типов только для staged TS/TSX файлов ---
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx)$' || true)
if [ -n "$STAGED_TS_FILES" ]; then
  echo "Checking TypeScript types for staged files..."

  # Проверяем webapp файлы
  WEBAPP_FILES=$(echo "$STAGED_TS_FILES" | grep '^webapp/' || true)
  if [ -n "$WEBAPP_FILES" ]; then
    cd webapp && pnpm tsc --noEmit && cd ..
  fi

  # Проверяем backend файлы
  BACKEND_FILES=$(echo "$STAGED_TS_FILES" | grep '^backend/' || true)
  if [ -n "$BACKEND_FILES" ]; then
    cd backend && pnpm tsc --noEmit && cd ..
  fi
fi
